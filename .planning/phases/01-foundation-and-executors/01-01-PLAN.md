---
phase: 01-foundation-and-executors
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - go.mod
  - go.sum
  - main.go
  - internal/config/config.go
  - internal/config/config_test.go
  - internal/assets/assets.go
  - internal/assets/prompts/extract-name.txt
  - internal/assets/prompts/optimize.txt
  - internal/assets/prompts/optimize-ats.txt
  - internal/assets/prompts/md-to-json-resume.txt
  - internal/assets/schema/resume.schema.json
autonomous: true

must_haves:
  truths:
    - "Config repository finds m2cv.yml by walking up directory tree from cwd"
    - "Config repository respects --config flag and M2CV_CONFIG env var overrides"
    - "Embedded prompts and schema compile into binary and are readable at runtime"
    - "go build produces a binary without errors"
  artifacts:
    - path: "go.mod"
      provides: "Go module definition with cobra, yaml.v3, jsonschema/v6 dependencies"
      contains: "module github.com/richq/m2cv"
    - path: "internal/config/config.go"
      provides: "Config struct and repository with walk-up discovery"
      exports: ["Config", "Repository", "NewRepository", "Find"]
    - path: "internal/assets/assets.go"
      provides: "Embedded prompt and schema access"
      exports: ["GetPrompt", "GetSchema"]
    - path: "internal/assets/schema/resume.schema.json"
      provides: "JSON Resume schema for validation"
      contains: "jsonresume"
  key_links:
    - from: "internal/config/config.go"
      to: "gopkg.in/yaml.v3"
      via: "YAML marshal/unmarshal"
      pattern: "yaml\\.(Unmarshal|Marshal)"
    - from: "internal/assets/assets.go"
      to: "internal/assets/prompts/*.txt"
      via: "go:embed directive"
      pattern: "//go:embed"
---

<objective>
Scaffold the Go project with module initialization, config repository, and embedded assets.

Purpose: Establish the project structure and two foundational subsystems (config discovery and embedded assets) that all subsequent plans depend on.
Output: Buildable Go module with config loading from m2cv.yml (walk-up discovery) and embedded prompt/schema files compiled into binary.
</objective>

<execution_context>
@/Users/rich/.claude/get-shit-done/workflows/execute-plan.md
@/Users/rich/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-and-executors/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize Go module and project structure</name>
  <files>go.mod, main.go, internal/config/, internal/assets/, internal/assets/prompts/, internal/assets/schema/</files>
  <action>
Initialize Go module as `github.com/richq/m2cv` (or appropriate module path - check if go.mod already exists first).

Install dependencies:
- `github.com/spf13/cobra` (latest, v1.9.1+)
- `gopkg.in/yaml.v3`
- `github.com/santhosh-tekuri/jsonschema/v6`

Create directory structure:
```
main.go                          # minimal main, just calls cmd.Execute()
internal/
  config/
  assets/
    prompts/
    schema/
  executor/
cmd/
```

Create minimal `main.go`:
```go
package main

import (
    "fmt"
    "os"
)

func main() {
    // CLI wiring happens in Plan 03
    fmt.Println("m2cv - Markdown to CV")
    os.Exit(0)
}
```

Create placeholder prompt files (content will be refined in later phases, but files must exist for embed):
- `internal/assets/prompts/extract-name.txt` - "Extract company name and role from the following job description. Return ONLY a folder name in company-role format (lowercase, hyphens). No explanation.\n\n{{.JobDescription}}"
- `internal/assets/prompts/optimize.txt` - "Tailor the following CV for the given job description. Maintain the same markdown format with YAML frontmatter. Emphasize relevant experience and skills.\n\nBase CV:\n{{.BaseCV}}\n\nJob Description:\n{{.JobDescription}}"
- `internal/assets/prompts/optimize-ats.txt` - "Tailor the following CV for the given job description. Optimize for ATS (Applicant Tracking Systems): use standard section headings, include keywords from the job description, avoid tables/columns/graphics. Maintain markdown format with YAML frontmatter.\n\nBase CV:\n{{.BaseCV}}\n\nJob Description:\n{{.JobDescription}}"
- `internal/assets/prompts/md-to-json-resume.txt` - "Convert the following markdown CV (with YAML frontmatter) to valid JSON Resume format. Return ONLY the JSON object, no markdown fences or explanation.\n\nCV:\n{{.CV}}"

Fetch the JSON Resume schema and save to `internal/assets/schema/resume.schema.json`. Use: `curl -sL https://raw.githubusercontent.com/jsonresume/resume-schema/master/schema.json > internal/assets/schema/resume.schema.json`. If curl fails, create a minimal valid JSON schema placeholder with `{"type": "object"}` and add a TODO comment.

Verify: `go build ./...` succeeds.
  </action>
  <verify>Run `go build ./...` - must compile without errors. Run `ls internal/assets/prompts/` - must show 4 .txt files. Run `ls internal/assets/schema/` - must show resume.schema.json.</verify>
  <done>Go module initialized with all dependencies, directory structure created, prompt templates and JSON Resume schema in place.</done>
</task>

<task type="auto">
  <name>Task 2: Implement config repository with walk-up discovery</name>
  <files>internal/config/config.go, internal/config/config_test.go</files>
  <action>
Create `internal/config/config.go` with:

1. `Config` struct with YAML tags:
   - `BaseCVPath string` (yaml:"base_cv_path") - path to base CV markdown
   - `DefaultTheme string` (yaml:"default_theme") - JSON Resume theme name
   - `Themes []string` (yaml:"themes") - installed theme list
   - `DefaultModel string` (yaml:"default_model") - Claude model name

2. `Repository` interface:
   - `Load(configPath string) (*Config, error)` - load and parse YAML
   - `Save(configPath string, cfg *Config) error` - write YAML
   - `Find(startDir string) (string, error)` - walk up tree to find m2cv.yml

3. `NewRepository() Repository` - returns yamlRepository implementation

4. `Find(startDir string)` implementation - walk-up directory tree search:
   - Walk from startDir up to filesystem root looking for "m2cv.yml"
   - Return full path when found
   - Return descriptive error if not found

5. `FindWithOverrides(configFlag, startDir string) (string, error)` - full discovery:
   - If configFlag non-empty, return it (explicit --config flag)
   - If M2CV_CONFIG env var set, return it
   - Otherwise call Find(startDir) for walk-up discovery

Create `internal/config/config_test.go` with tests:
- Test Load with valid YAML file (use t.TempDir())
- Test Load with invalid YAML (should return error)
- Test Find walks up directory tree (create nested temp dirs with m2cv.yml in parent)
- Test Find returns error when no config found
- Test FindWithOverrides prefers flag over env over walk-up
- Test Save writes valid YAML that Load can read back

Use `os.ReadFile`/`os.WriteFile` for file I/O (not Bun.file - this is Go).
Use standard `testing` package, NOT testify.
  </action>
  <verify>Run `go test ./internal/config/ -v` - all tests pass. Run `go build ./...` - compiles.</verify>
  <done>Config repository loads m2cv.yml via walk-up discovery, respects --config flag and M2CV_CONFIG env var, all tests pass.</done>
</task>

<task type="auto">
  <name>Task 3: Implement embedded assets accessor</name>
  <files>internal/assets/assets.go</files>
  <action>
Create `internal/assets/assets.go` with:

1. Package-level embed directives:
   ```go
   //go:embed prompts/*.txt
   var promptFS embed.FS

   //go:embed schema/*.json
   var schemaFS embed.FS
   ```

2. `GetPrompt(name string) (string, error)` - reads from promptFS, returns content as string. Name is without extension (e.g., "optimize" reads "prompts/optimize.txt").

3. `GetSchema(name string) ([]byte, error)` - reads from schemaFS, returns raw bytes. Name includes extension (e.g., "resume.schema.json").

4. `ListPrompts() ([]string, error)` - returns available prompt names (useful for debugging/validation).

Do NOT add tests for embed.FS - Go embed is compile-time verified. The verify step confirms files compile into binary correctly.
  </action>
  <verify>Run `go build ./...` - compiles (embed directives resolve). Add a temporary main that calls `assets.GetPrompt("optimize")` and prints length, verify it returns non-empty content, then remove the temporary code.</verify>
  <done>Embedded assets compile into binary. GetPrompt and GetSchema return correct content at runtime.</done>
</task>

</tasks>

<verification>
1. `go build ./...` compiles without errors
2. `go test ./internal/config/ -v` - all config tests pass
3. Binary includes embedded prompts (verified via GetPrompt call)
4. Config Find() discovers m2cv.yml from subdirectory (verified via test)
</verification>

<success_criteria>
- Go module builds cleanly with cobra, yaml.v3, jsonschema/v6 dependencies
- Config repository finds m2cv.yml via walk-up directory tree, flag override, and env var override
- Embedded prompts (4 files) and JSON Resume schema compile into binary
- All tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-and-executors/01-01-SUMMARY.md`
</output>
