---
phase: 03-application-workflow
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - internal/filesystem/operations.go
  - internal/filesystem/operations_test.go
  - internal/extractor/folder_name.go
  - internal/extractor/folder_name_test.go
autonomous: true

must_haves:
  truths:
    - "Filesystem operations can create directories and copy files"
    - "Claude can extract company-role from job description"
    - "Extracted name is sanitized for filesystem safety"
  artifacts:
    - path: "internal/filesystem/operations.go"
      provides: "Repository interface for directory creation and file copy"
      exports: ["Operations", "NewOperations", "CreateDir", "CopyFile", "Exists"]
    - path: "internal/extractor/folder_name.go"
      provides: "Claude integration for folder name extraction"
      exports: ["ExtractFolderName", "SanitizeFilename"]
  key_links:
    - from: "internal/extractor/folder_name.go"
      to: "internal/executor/claude.go"
      via: "ClaudeExecutor.Execute call"
      pattern: "executor\\.Execute"
    - from: "internal/extractor/folder_name.go"
      to: "internal/assets/assets.go"
      via: "GetPrompt for extract-name"
      pattern: "assets\\.GetPrompt"
---

<objective>
Create filesystem abstraction layer and AI-powered folder name extraction.

Purpose: Foundation for apply command - ability to create directories, copy files, and extract meaningful folder names from job descriptions via Claude.
Output: Two packages ready for use by the apply command.
</objective>

<execution_context>
@/home/claude/.claude/get-shit-done/workflows/execute-plan.md
@/home/claude/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-application-workflow/03-RESEARCH.md

# Existing code to integrate with
@internal/executor/claude.go
@internal/assets/assets.go
@internal/assets/prompts/extract-name.txt
</context>

<tasks>

<task type="auto">
  <name>Task 1: Filesystem Operations Repository</name>
  <files>internal/filesystem/operations.go, internal/filesystem/operations_test.go</files>
  <action>
Create internal/filesystem package with repository interface pattern (matching codebase convention from config package).

Interface Operations:
- CreateDir(path string, perm os.FileMode) error - wraps os.MkdirAll
- CopyFile(src, dst string) error - streaming copy with io.Copy, calls dest.Sync()
- Exists(path string) bool - checks if path exists (for folder collision detection)

Implementation osOperations:
- NewOperations() Operations - returns real filesystem implementation
- Use defer for Close() calls
- CopyFile should: open src, create dst, io.Copy, sync

Tests (table-driven, t.Parallel()):
- TestCreateDir: creates directory, creates nested directories, handles existing directory
- TestCopyFile: copies file correctly, source not found returns error, destination dir created
- TestExists: returns true for existing file/dir, returns false for non-existent

Use t.TempDir() for test isolation - no mocking needed for these tests since os operations are safe in temp dirs.
  </action>
  <verify>go test ./internal/filesystem/... -v</verify>
  <done>All filesystem operations tests pass, interface matches repository pattern</done>
</task>

<task type="auto">
  <name>Task 2: Folder Name Extractor with Claude Integration</name>
  <files>internal/extractor/folder_name.go, internal/extractor/folder_name_test.go</files>
  <action>
Create internal/extractor package for AI-powered extraction.

Functions:
1. SanitizeFilename(s string) string
   - Convert to lowercase
   - Replace spaces, slashes, backslashes with hyphens
   - Keep only letters, numbers, hyphens, underscores
   - Collapse multiple hyphens into one
   - Trim leading/trailing hyphens
   - Max length 50 chars (truncate at word boundary if possible)

2. ExtractFolderName(ctx context.Context, executor executor.ClaudeExecutor, jobDesc string) (string, error)
   - Load prompt template: assets.GetPrompt("extract-name")
   - Replace {{.JobDescription}} placeholder with jobDesc
   - Execute via ClaudeExecutor with default settings (text output)
   - Trim whitespace from response
   - Apply SanitizeFilename to result
   - Return error if result is empty after sanitization

Tests for SanitizeFilename (table-driven):
- "Google Inc" -> "google-inc"
- "Software Engineer" -> "software-engineer"
- "Google/Software Engineer" -> "google-software-engineer"
- "  spaced  out  " -> "spaced-out"
- "Special $#@! chars" -> "special-chars"
- Very long name (100 chars) -> truncated to 50

Tests for ExtractFolderName (with mock executor):
- Valid extraction returns sanitized name
- Empty Claude response returns error
- Claude execution error propagates

Create a mock executor in test file that implements ClaudeExecutor interface.
  </action>
  <verify>go test ./internal/extractor/... -v</verify>
  <done>Sanitization handles edge cases, extraction integrates with ClaudeExecutor correctly</done>
</task>

</tasks>

<verification>
Both packages compile and integrate:
```bash
go build ./...
go test ./internal/filesystem/... ./internal/extractor/... -v
```
</verification>

<success_criteria>
- Filesystem operations work correctly with real filesystem (via t.TempDir)
- Folder name extraction uses existing ClaudeExecutor and assets.GetPrompt
- Sanitization handles Unicode, special characters, length limits
- All tests pass with -race flag
</success_criteria>

<output>
After completion, create `.planning/phases/03-application-workflow/03-01-SUMMARY.md`
</output>
