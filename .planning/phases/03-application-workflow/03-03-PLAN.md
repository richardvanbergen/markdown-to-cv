---
phase: 03-application-workflow
plan: 03
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - internal/application/versioning.go
  - internal/application/versioning_test.go
autonomous: true

must_haves:
  truths:
    - "System can find next version number for optimized CV"
    - "Versioned files follow optimized-cv-N.md pattern"
    - "Version numbers increment correctly (1, 2, 3...)"
  artifacts:
    - path: "internal/application/versioning.go"
      provides: "Version number management for optimized CVs"
      exports: ["NextVersionPath", "LatestVersionPath", "ListVersions"]
    - path: "internal/application/versioning_test.go"
      provides: "Tests for versioning logic"
      min_lines: 80
  key_links:
    - from: "internal/application/versioning.go"
      to: "os and filepath packages"
      via: "Directory reading and path manipulation"
      pattern: "filepath\\.(Join|Glob)"
---

<objective>
Create versioning utilities for optimized CV output files.

Purpose: Support WORK-04 requirement - versioned output (optimized-cv-1.md, optimized-cv-2.md). Prepares for Phase 4 optimize command.
Output: Versioning package ready for use by optimize command.
</objective>

<execution_context>
@/home/claude/.claude/get-shit-done/workflows/execute-plan.md
@/home/claude/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-application-workflow/03-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Versioning Utilities</name>
  <files>internal/application/versioning.go, internal/application/versioning_test.go</files>
  <action>
Create internal/application package for application folder utilities.

Constants:
- OptimizedCVPrefix = "optimized-cv-"
- OptimizedCVSuffix = ".md"

Functions:

1. ListVersions(appDir string) ([]int, error)
   - Use filepath.Glob to find optimized-cv-*.md files
   - Parse version numbers from filenames
   - Return sorted slice of version numbers (ascending)
   - Return empty slice if no versions exist (not an error)
   - Ignore malformed filenames (optimized-cv-abc.md)

2. LatestVersionPath(appDir string) (string, error)
   - Call ListVersions
   - Return path to highest version, or "" if none exist
   - If no versions: return "", nil (not an error - means no optimized CV yet)

3. NextVersionPath(appDir string) (string, error)
   - Call ListVersions
   - Calculate next version (max + 1, or 1 if empty)
   - Return filepath.Join(appDir, fmt.Sprintf("optimized-cv-%d.md", nextVersion))

Tests (table-driven):

TestListVersions:
- Empty directory -> []
- Single version (optimized-cv-1.md) -> [1]
- Multiple versions (1, 3, 2) -> [1, 2, 3] (sorted)
- Mixed files (optimized-cv-1.md, other.txt, optimized-cv-abc.md) -> [1]
- Non-existent directory -> error

TestLatestVersionPath:
- Empty directory -> "", nil
- Has versions -> path to highest

TestNextVersionPath:
- Empty directory -> optimized-cv-1.md
- Has version 1 -> optimized-cv-2.md
- Has versions 1, 2, 5 -> optimized-cv-6.md (max + 1)

Use t.TempDir() for test isolation.
  </action>
  <verify>go test ./internal/application/... -v</verify>
  <done>Versioning functions handle all edge cases, tests pass</done>
</task>

</tasks>

<verification>
Package compiles and tests pass:
```bash
go build ./...
go test ./internal/application/... -v -race
```
</verification>

<success_criteria>
- ListVersions correctly parses and sorts version numbers
- NextVersionPath always returns valid incremented path
- LatestVersionPath finds highest version
- Empty directories handled gracefully (not errors)
- Malformed filenames ignored without error
</success_criteria>

<output>
After completion, create `.planning/phases/03-application-workflow/03-03-SUMMARY.md`
</output>
